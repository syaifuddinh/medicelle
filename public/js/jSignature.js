!function(){var t="jSignature",n=function(t,n){var e;return this.kick=function(){clearTimeout(e),e=setTimeout(n,t)},this.clear=function(){clearTimeout(e)},this},e=function(t){"use strict";this.topics={},this.context=t||this,this.publish=function(t,n,e,i){if(this.topics[t]){var a,s,r,o,h=this.topics[t],c=Array.prototype.slice.call(arguments,1),d=[],u=[];for(s=0,r=h.length;s<r;s++)a=(o=h[s])[0],o[1]&&(o[0]=function(){},d.push(s)),u.push(a);for(s=0,r=d.length;s<r;s++)h.splice(d[s],1);for(s=0,r=u.length;s<r;s++)u[s].apply(this.context,c)}},this.subscribe=function(t,n,e){return this.topics[t]?this.topics[t].push([n,e]):this.topics[t]=[[n,e]],{topic:t,callback:n}},this.unsubscribe=function(t){if(this.topics[t.topic])for(var n=this.topics[t.topic],e=0,i=n.length;e<i;e++)n[e]&&n[e][0]===t.callback&&n.splice(e,1)}};function i(t,n){this.x=t,this.y=n,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var e=function(t){return Math.round(t/Math.abs(t))};this.resizeTo=function(t){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=t,this.y=t*e(this.y);else if(0===this.y)this._length=t,this.x=t*e(this.x);else{var n=Math.abs(this.y/this.x),i=Math.sqrt(Math.pow(t,2)/(1+Math.pow(n,2))),a=n*i;this._length=t,this.x=i*e(this.x),this.y=a*e(this.y)}return this},this.angleTo=function(t){var n=this.getLength()*t.getLength();return 0===n?0:Math.acos(Math.min(Math.max((this.x*t.x+this.y*t.y)/n,-1),1))/Math.PI}}function a(t,n){this.x=t,this.y=n,this.getVectorToCoordinates=function(t,n){return new i(t-this.x,n-this.y)},this.getVectorFromCoordinates=function(t,n){return this.getVectorToCoordinates(t,n).reverse()},this.getVectorToPoint=function(t){return new i(t.x-this.x,t.y-this.y)},this.getVectorFromPoint=function(t){return this.getVectorToPoint(t).reverse()}}function s(t,n,e,i,a){if(this.data=t,this.context=n,t.length)for(var s,r,o=t.length,h=0;h<o;h++){r=(s=t[h]).x.length,e.call(n,s);for(var c=1;c<r;c++)i.call(n,s,c);a.call(n,s)}this.changed=function(){},this.startStrokeFn=e,this.addToStrokeFn=i,this.endStrokeFn=a,this.inStroke=!1,this._lastPoint=null,this._stroke=null,this.startStroke=function(t){if(t&&"number"==typeof t.x&&"number"==typeof t.y){this._stroke={x:[t.x],y:[t.y]},this.data.push(this._stroke),this._lastPoint=t,this.inStroke=!0;var n=this._stroke,e=this.startStrokeFn,i=this.context;return setTimeout(function(){e.call(i,n)},3),t}return null},this.addToStroke=function(t){if(this.inStroke&&"number"==typeof t.x&&"number"==typeof t.y&&Math.abs(t.x-this._lastPoint.x)+Math.abs(t.y-this._lastPoint.y)>4){var n=this._stroke.x.length;this._stroke.x.push(t.x),this._stroke.y.push(t.y),this._lastPoint=t;var e=this._stroke,i=this.addToStrokeFn,a=this.context;return setTimeout(function(){i.call(a,e,n)},3),t}return null},this.endStroke=function(){var t=this.inStroke;if(this.inStroke=!1,this._lastPoint=null,t){var n=this._stroke,e=this.endStrokeFn,i=this.context,a=this.changed;return setTimeout(function(){e.call(i,n),a.call(i)},3),!0}return null}}var r=function(t,n,e,i,a){t.beginPath(),t.moveTo(n,e),t.lineTo(i,a),t.closePath(),t.stroke()},o=function(t,n,e,i,a,s,r,o,h){t.beginPath(),t.moveTo(n,e),t.bezierCurveTo(s,r,o,h,i,a),t.closePath(),t.stroke()},h=function(t){var n,e,i,a,s;n=this.canvasContext,e=t.x[0],i=t.y[0],a=this.settings.lineWidth,s=n.fillStyle,n.fillStyle=n.strokeStyle,n.fillRect(e+a/-2,i+a/-2,a,a),n.fillStyle=s},c=function(t,n){var e=new a(t.x[n-1],t.y[n-1]),s=new a(t.x[n],t.y[n]),h=e.getVectorToPoint(s);if(n>1){var c,d=new a(t.x[n-2],t.y[n-2]),u=d.getVectorToPoint(e);if(u.getLength()>this.lineCurveThreshold){c=n>2?new a(t.x[n-3],t.y[n-3]).getVectorToPoint(d):new i(0,0);var l=.35*u.getLength(),f=u.angleTo(c.reverse()),g=h.angleTo(u.reverse()),v=new i(c.x+u.x,c.y+u.y).resizeTo(Math.max(.05,f)*l),p=new i(u.x+h.x,u.y+h.y).reverse().resizeTo(Math.max(.05,g)*l);o(this.canvasContext,d.x,d.y,e.x,e.y,d.x+v.x,d.y+v.y,e.x+p.x,e.y+p.y)}}h.getLength()<=this.lineCurveThreshold&&r(this.canvasContext,e.x,e.y,s.x,s.y)},d=function(t){var n=t.x.length-1;if(n>0){var e,s=new a(t.x[n],t.y[n]),h=new a(t.x[n-1],t.y[n-1]),c=h.getVectorToPoint(s);if(c.getLength()>this.lineCurveThreshold)if(n>1){var d=new i((e=new a(t.x[n-2],t.y[n-2]).getVectorToPoint(h)).x+c.x,e.y+c.y).resizeTo(c.getLength()/2);o(this.canvasContext,h.x,h.y,s.x,s.y,h.x+d.x,h.y+d.y,s.x,s.y)}else r(this.canvasContext,h.x,h.y,s.x,s.y)}};function u(i,s,r){var o=this.$parent=$(i),h=this.eventTokens={},c=(this.events=new e(this),$.fn[t]("globalEvents")),d={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,readOnly:!1,data:[],signatureLine:!1};for(var u in $.extend(d,function(t){for(var n,e,i=t.css("color"),a=t[0],s=!1;a&&!e&&!s;){try{n=$(a).css("background-color")}catch(t){n="transparent"}"transparent"!==n&&"rgba(0, 0, 0, 0)"!==n&&(e=n),s=a.body,a=a.parentNode}var r,o,h=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,c=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/;n=void 0,(n=i.match(h))?r={r:parseInt(n[1],10),g:parseInt(n[2],10),b:parseInt(n[3],10)}:(n=i.match(c))&&(r={r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}),e?(n=void 0,(n=e.match(h))?o={r:parseInt(n[1],10),g:parseInt(n[2],10),b:parseInt(n[3],10)}:(n=e.match(c))&&(o={r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)})):o=r&&Math.max.apply(null,[r.r,r.g,r.b])>127?{r:0,g:0,b:0}:{r:255,g:255,b:255};var d,u,l,f=function(t){return"rgb("+[t.r,t.g,t.b].join(", ")+")"};if(r&&o){var g=Math.max.apply(null,[r.r,r.g,r.b]);u=Math.max.apply(null,[o.r,o.g,o.b]),d={r:l=Math.round(u+-1*(u-g)*.75),g:l,b:l}}else if(r){var v=1;(u=Math.max.apply(null,[r.r,r.g,r.b]))>127&&(v=-1),d={r:l=Math.round(u+96*v),g:l,b:l}}else d={r:191,g:191,b:191};return{color:i,"background-color":o?f(o):e,"decor-color":f(d)}}(o)),s&&$.extend(d,s),this.settings=d,r)r.hasOwnProperty(u)&&r[u].call(this,u);this.events.publish(t+".initializing"),this.$controlbarUpper=$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none; touch-action: none;margin-top:-1em !important; margin-bottom:1em !important;"></div>').appendTo(o),this.isCanvasEmulator=!1;var l,f,g=this.canvas=this.initializeCanvas(d),v=$(g);this.$controlbarLower=$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none; touch-action: none;margin-top:-1.5em !important; margin-bottom:1.5em !important; position: relative;"></div>').appendTo(o),this.canvasContext=g.getContext("2d"),v.data(t+".this",this),d.lineWidth=(l=d.lineWidth,f=g.width,l||Math.max(Math.round(f/400),2)),this.lineCurveThreshold=3*d.lineWidth,d.cssclass&&""!=$.trim(d.cssclass)&&v.addClass(d.cssclass),this.fatFingerCompensation=0;var p=function(t){var e,i,s=function(n){var s=n.changedTouches&&n.changedTouches.length>0?n.changedTouches[0]:n;return new a(Math.round(s.pageX+e),Math.round(s.pageY+i)+t.fatFingerCompensation)},r=new n(750,function(){t.dataEngine.endStroke()});return this.drawEndHandler=function(n){if(!t.settings.readOnly){try{n.preventDefault()}catch(t){}r.clear(),t.dataEngine.endStroke()}},this.drawStartHandler=function(n){var a;t.settings.readOnly||(n.preventDefault(),a=$(t.canvas).offset(),e=-1*a.left,i=-1*a.top,t.dataEngine.startStroke(s(n)),r.kick())},this.drawMoveHandler=function(n){if(!t.settings.readOnly){if(n.preventDefault(),!t.dataEngine.inStroke)return;t.dataEngine.addToStroke(s(n)),r.kick()}},this}.call({},this);return function(n,e,i){var a=this.canvas,s=$(a);if(this.isCanvasEmulator)s.bind("mousemove."+t,i),s.bind("mouseup."+t,n),s.bind("mousedown."+t,e);else{var r="function"==typeof a.addEventListener;this.ontouchstart=function(t){a.onmousedown=a.onmouseup=a.onmousemove=void 0,this.fatFingerCompensation=d.minFatFingerCompensation&&-3*d.lineWidth>d.minFatFingerCompensation?-3*d.lineWidth:d.minFatFingerCompensation,e(t),r?(a.addEventListener("touchend",n),a.addEventListener("touchstart",e),a.addEventListener("touchmove",i)):(a.ontouchend=n,a.ontouchstart=e,a.ontouchmove=i)},r?a.addEventListener("touchstart",this.ontouchstart):a.ontouchstart=ontouchstart,a.onmousedown=function(t){r?a.removeEventListener("touchstart",this.ontouchstart):a.ontouchstart=a.ontouchend=a.ontouchmove=void 0,e(t),a.onmousedown=e,a.onmouseup=n,a.onmousemove=i},window.navigator.msPointerEnabled&&(a.onmspointerdown=e,a.onmspointerup=n,a.onmspointermove=i)}}.call(this,p.drawEndHandler,p.drawStartHandler,p.drawMoveHandler),h[t+".windowmouseup"]=c.subscribe(t+".windowmouseup",p.drawEndHandler),this.events.publish(t+".attachingEventHandlers"),function(t,n,e,i){"use strict";var a,s,r;"ratio"!==n&&"%"!==n.split("")[n.length-1]||(this.eventTokens[e+".parentresized"]=i.subscribe(e+".parentresized",(a=this.eventTokens,s=this.$parent,r=this.$parent.width(),this.canvas.width,this.canvas.height,function(){var n=s.width();if(n!==r){for(var o in a)a.hasOwnProperty(o)&&(i.unsubscribe(a[o]),delete a[o]);var h=t.settings;for(var o in t.$parent.children().remove(),t)t.hasOwnProperty(o)&&delete t[o];h.data=function(t,n){var e,i,a,s,r,o,h=[];for(i=0,a=t.length;i<a;i++){for(e={x:[],y:[]},s=0,r=(o=t[i]).x.length;s<r;s++)e.x.push(o.x[s]*n),e.y.push(o.y[s]*n);h.push(e)}return h}(h.data,1*n/r),s[e](h)}})))}.call(this,this,d.width.toString(10),t,c),this.resetCanvas(d.data),this.events.publish(t+".initialized"),this}u.prototype.resetCanvas=function(n,e){var i=this.canvas,a=this.settings,o=this.canvasContext,u=this.isCanvasEmulator,l=i.width,f=i.height;if(e||o.clearRect(0,0,l+30,f+30),o.shadowColor=o.fillStyle=a["background-color"],u&&o.fillRect(0,0,l+30,f+30),o.lineWidth=Math.ceil(parseInt(a.lineWidth,10)),o.lineCap=o.lineJoin="round",a.signatureLine){if(null!=a["decor-color"]){o.strokeStyle=a["decor-color"],o.shadowOffsetX=0,o.shadowOffsetY=0;var g=Math.round(f/5);r(o,1.5*g,f-g,l-1.5*g,f-g)}u||(o.shadowColor=o.strokeStyle,o.shadowOffsetX=.5*o.lineWidth,o.shadowOffsetY=-.6*o.lineWidth,o.shadowBlur=0)}o.strokeStyle=a.color,n||(n=[]);var v=this.dataEngine=new s(n,this,h,c,d);return a.data=n,$(i).data(t+".data",n).data(t+".settings",a),v.changed=function(t,n,e){"use strict";return function(){n.publish(e+".change"),t.trigger("change")}}(this.$parent,this.events,t),v.changed(),!0},u.prototype.initializeCanvas=function(n){var e=document.createElement("canvas"),i=$(e);return n.width===n.height&&"ratio"===n.height&&(n.width="100%"),i.css({margin:0,padding:0,border:"none",height:"ratio"!==n.height&&n.height?n.height.toString(10):1,width:"ratio"!==n.width&&n.width?n.width.toString(10):1,"-ms-touch-action":"none","touch-action":"none","background-color":n["background-color"]}),i.appendTo(this.$parent),"ratio"===n.height?i.css("height",Math.round(i.width()/n.sizeRatio)):"ratio"===n.width&&i.css("width",Math.round(i.height()*n.sizeRatio)),i.addClass(t),e.width=i.width(),e.height=i.height(),this.isCanvasEmulator=function(t){if(t.getContext)return!1;var n=t.ownerDocument.parentWindow,e=n.FlashCanvas?t.ownerDocument.parentWindow.FlashCanvas:"undefined"==typeof FlashCanvas?void 0:FlashCanvas;if(e){t=e.initElement(t);var i=1;if(n&&n.screen&&n.screen.deviceXDPI&&n.screen.logicalXDPI&&(i=1*n.screen.deviceXDPI/n.screen.logicalXDPI),1!==i)try{$(t).children("object").get(0).resize(Math.ceil(t.width*i),Math.ceil(t.height*i)),t.getContext("2d").scale(i,i)}catch(t){}return!0}throw new Error("Canvas element does not support 2d context. jSignature cannot proceed.")}(e),e.onselectstart=function(t){return t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),!1},e};!function(n){var i=new e;!function(t,n,e,i){"use strict";var a,s=function(){t.publish(n+".parentresized")};e(i).bind("resize."+n,function(){a&&clearTimeout(a),a=setTimeout(s,500)}).bind("mouseup."+n,function(e){t.publish(n+".windowmouseup")})}(i,t,$,n);var a={},s={default:function(t){return this.toDataURL()},native:function(t){return t},image:function(t){var n=this.toDataURL();if("string"==typeof n&&n.length>4&&"data:"===n.slice(0,5)&&-1!==n.indexOf(",")){var e=n.indexOf(",");return[n.slice(5,e),n.substr(e+1)]}return[]}};function r(t,n,e){"use strict";var i=new Image,a=this;i.onload=function(){var t=a.getContext("2d"),n=t.shadowColor;t.shadowColor="transparent",t.drawImage(i,0,0,i.width<a.width?i.width:a.width,i.height<a.height?i.height:a.height),t.shadowColor=n},i.src="data:"+n+","+t}var o={native:function(t,n,e){e(t)},image:r,"image/png;base64":r,"image/jpeg;base64":r,"image/jpg;base64":r};function h(n,e){return this.find("canvas."+t).add(this.filter("canvas."+t)).data(t+".this").resetCanvas(n,e),this}function c(n,e){if(void 0!==e||"string"!=typeof n||"data:"!==n.substr(0,5)||(e=n.slice(5).split(",")[0])!==(n=n.slice(6+e.length))){var i,a=this.find("canvas."+t).add(this.filter("canvas."+t));if(!o.hasOwnProperty(e))throw new Error(t+" is unable to find import plugin with for format '"+String(e)+"'");return 0!==a.length&&o[e].call(a[0],n,e,(i=a.data(t+".this"),function(){return i.resetCanvas.apply(i,arguments)})),this}}var d=function(t){var n=!1;for(t=t.parentNode;t&&!n;)n=t.body,t=t.parentNode;return!n},l={export:s,import:o,instance:a},f={init:function(t){return this.each(function(){d(this)||new u(this,t,a)})},destroy:function(){return this.each(function(){if(!d(this)){var n=$(this).find("canvas").data(t+".this");if(n)for(var e in n.$controlbarLower.remove(),n.$controlbarUpper.remove(),$(n.canvas).remove(),n.eventTokens)n.eventTokens.hasOwnProperty(e)&&i.unsubscribe(n.eventTokens[e])}})},getSettings:function(){return this.find("canvas."+t).add(this.filter("canvas."+t)).data(t+".this").settings},isModified:function(){return null!==this.find("canvas."+t).add(this.filter("canvas."+t)).data(t+".this").dataEngine._stroke},updateSetting:function(n,e,i){var a=this.find("canvas."+t).add(this.filter("canvas."+t)).data(t+".this");return a.settings[n]=e,a.resetCanvas(i?null:a.settings.data,!0),a.settings[n]},clear:h,reset:h,addPlugin:function(t,n,e){return l.hasOwnProperty(t)&&(l[t][n]=e),this},listPlugins:function(t){var n=[];if(l.hasOwnProperty(t)){var e=l[t];for(var i in e)e.hasOwnProperty(i)&&n.push(i)}return n},getData:function(n){var e=this.find("canvas."+t).add(this.filter("canvas."+t));if(void 0===n&&(n="default"),0!==e.length&&s.hasOwnProperty(n))return s[n].call(e.get(0),e.data(t+".data"),e.data(t+".settings"))},importData:c,setData:c,globalEvents:function(){return i},disable:function(){this.find("input").attr("disabled",1),this.find("canvas."+t).addClass("disabled").data(t+".this").settings.readOnly=!0},enable:function(){this.find("input").removeAttr("disabled"),this.find("canvas."+t).removeClass("disabled").data(t+".this").settings.readOnly=!1},events:function(){return this.find("canvas."+t).add(this.filter("canvas."+t)).data(t+".this").events}};$.fn[t]=function(n){"use strict";return n&&"object"!=typeof n?"string"==typeof n&&f[n]?f[n].apply(this,Array.prototype.slice.call(arguments,1)):void $.error("Method "+String(n)+" does not exist on jQuery."+t):f.init.apply(this,arguments)}}(window)}();